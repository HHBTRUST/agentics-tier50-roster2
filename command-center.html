<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentics Live Trading Center</title>
    <script src="api-config.js"></script>
    <script src="live-agents.js"></script>
    <style>
        body {
            background: #0a0a0a;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .agent-panel {
            background: rgba(255,255,255,0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .results {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ AGENTICS LIVE TRADING CENTER ğŸ”¥</h1>
    
    <div class="agent-panel">
        <h2>ğŸ’° YIELDA - Stock & Dividend Agent</h2>
        <input type="text" id="stock-symbol" placeholder="Enter stock symbol (AAPL)" value="AAPL">
        <button class="test-btn" onclick="testLivePrice()">Get Live Price</button>
        <button class="test-btn" onclick="testDividendData()">Get Dividend Info</button>
        <div class="results" id="yielda-results">Ready to fetch real stock data...</div>
    </div>

    <div class="agent-panel">
        <h2>ğŸ“ˆ STACK - Trading Agent</h2>
        <button class="test-btn" onclick="testAccount()">Get Account Info</button>
        <button class="test-btn" onclick="testPositions()">Show Positions</button>
        <div class="results" id="stack-results">Ready to show trading account...</div>
    </div>

    <div class="agent-panel">
        <h2>ğŸ”— API Connection Status</h2>
        <button class="test-btn" onclick="testConnection()">Test All APIs</button>
        <div class="results" id="api-results">Click to test API connections...</div>
    </div>

    <script>
        // Wait for APIs to load
        window.addEventListener('load', async function() {
            console.log('Testing API availability...');
            
            // Test if APIs are loaded
            if (typeof agenticsAPI !== 'undefined') {
                document.getElementById('api-results').innerHTML = 'âœ… APIs loaded successfully';
            } else {
                document.getElementById('api-results').innerHTML = 'âŒ API files not loaded properly';
            }
        });

        async function testLivePrice() {
            const symbol = document.getElementById('stock-symbol').value.toUpperCase();
            const results = document.getElementById('yielda-results');
            
            try {
                results.innerHTML = `ğŸ”„ Fetching live price for ${symbol}...`;
                
                if (typeof yielda === 'undefined') {
                    throw new Error('Yielda agent not loaded');
                }
                
                const priceData = await yielda.getLivePrice(symbol);
                
                results.innerHTML = `
                    âœ… <strong>${priceData['01. symbol']}</strong><br>
                    ğŸ’° Price: $${priceData['05. price']}<br>
                    ğŸ“ˆ Change: ${priceData['09. change']} (${priceData['10. change percent']})<br>
                    ğŸ“Š Volume: ${parseInt(priceData['06. volume']).toLocaleString()}<br>
                    ğŸ“… Last Update: ${priceData['07. latest trading day']}
                `;
                
            } catch (error) {
                results.innerHTML = `âŒ Error: ${error.message}`;
                console.error('Price fetch error:', error);
            }
        }

        async function testDividendData() {
            const symbol = document.getElementById('stock-symbol').value.toUpperCase();
            const results = document.getElementById('yielda-results');
            
            try {
                results.innerHTML = `ğŸ”„ Fetching dividend data for ${symbol}...`;
                
                const response = await fetch(`https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${API_CONFIG.alphaVantage.key}`);
                const data = await response.json();
                
                if (data.Symbol) {
                    results.innerHTML = `
                        âœ… <strong>${data.Name} (${data.Symbol})</strong><br>
                        ğŸ’° Dividend Yield: ${data.DividendYield || 'N/A'}<br>
                        ğŸ’µ Dividend Per Share: $${data.DividendPerShare || 'N/A'}<br>
                        ğŸ“… Ex-Dividend Date: ${data.ExDividendDate || 'N/A'}<br>
                        ğŸ¢ Sector: ${data.Sector}<br>
                        ğŸ“Š Market Cap: ${data.MarketCapitalization ? '$' + (data.MarketCapitalization/1000000000).toFixed(1) + 'B' : 'N/A'}
                    `;
                } else {
                    throw new Error('No company data found');
                }
                
            } catch (error) {
                results.innerHTML = `âŒ Error: ${error.message}`;
                console.error('Dividend fetch error:', error);
            }
        }

        async function testAccount() {
            const results = document.getElementById('stack-results');
            
            try {
                results.innerHTML = `ğŸ”„ Fetching account information...`;
                
                if (typeof agenticsAPI === 'undefined') {
                    throw new Error('API client not loaded');
                }
                
                const account = await agenticsAPI.callAlpacaAPI('/v2/account');
                
                results.innerHTML = `
                    âœ… <strong>Alpaca Account Connected</strong><br>
                    ğŸ’° Portfolio Value: $${parseFloat(account.portfolio_value).toFixed(2)}<br>
                    ğŸ’µ Cash: $${parseFloat(account.cash).toFixed(2)}<br>
                    ğŸ“Š Buying Power: $${parseFloat(account.buying_power).toFixed(2)}<br>
                    âš¡ Status: ${account.status}<br>
                    ğŸ¦ Account: ${account.account_number}
                `;
                
            } catch (error) {
                results.innerHTML = `âŒ Error: ${error.message}`;
                console.error('Account fetch error:', error);
            }
        }

        async function testPositions() {
            const results = document.getElementById('stack-results');
            
            try {
                results.innerHTML = `ğŸ”„ Fetching portfolio positions...`;
                
                const positions = await agenticsAPI.callAlpacaAPI('/v2/positions');
                
                if (positions.length > 0) {
                    let positionsHTML = 'âœ… <strong>Current Positions:</strong><br>';
                    positions.forEach(pos => {
                        const pl = parseFloat(pos.unrealized_pl);
                        const plColor = pl >= 0 ? '#00ff00' : '#ff4444';
                        positionsHTML += `
                            ğŸ“ˆ ${pos.symbol}: ${pos.qty} shares<br>
                            ğŸ’° Value: $${parseFloat(pos.market_value).toFixed(2)}<br>
                            <span style="color: ${plColor}">ğŸ“Š P/L: $${pl.toFixed(2)}</span><br><br>
                        `;
                    });
                    results.innerHTML = positionsHTML;
                } else {
                    results.innerHTML = 'ğŸ“­ No positions found in portfolio';
                }
                
            } catch (error) {
                results.innerHTML = `âŒ Error: ${error.message}`;
                console.error('Positions fetch error:', error);
            }
        }

        async function testConnection() {
            const results = document.getElementById('api-results');
            
            try {
                results.innerHTML = 'ğŸ”„ Testing API connections...';
                
                // Test Alpha Vantage
                const avTest = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=AAPL&apikey=${API_CONFIG.alphaVantage.key}`);
                const avData = await avTest.json();
                
                // Test Alpaca
                const alpacaTest = await agenticsAPI.callAlpacaAPI('/v2/account');
                
                results.innerHTML = `
                    âœ… <strong>All APIs Connected Successfully!</strong><br>
                    ğŸŸ¢ Alpha Vantage: Connected<br>
                    ğŸŸ¢ Alpaca Trading: Connected<br>
                    ğŸ’° Ready for live trading operations<br>
                    ğŸ“Š Real market data flowing
                `;
                
            } catch (error) {
                results.innerHTML = `âŒ API Connection Failed: ${error.message}`;
                console.error('Connection test error:', error);
            }
        }
    </script>
</body>
</html>
